## About Vendor

Issabel is a Free Open Source Software that Unifies your comunications in a single plataform, itâ€™s based on Asterisk (Digium the Asterisk Company) we integrate PBX, mailing and collaborating task, we also integrate a database server.


## vulnerable software

The CVE has been assigned for the latest updated ISO `issabel4-USB-DVD-x86_64-20200102.iso` with sha256 hash value `560DDC9C574904E23B4DE7E6DB3FB6FB544D660F1C04ED1027B0D365C6F88AE9` 


## Technical Details 

an endpoint was identified using the following code snippet : 

```php
if (isset($_REQUEST['filename'])){
    $filename = escapeshellarg($_REQUEST['filename']);
    $filename = substr($filename,1,-1);
    $filename = $backup_dir."/".$filename;
    if(is_file($filename)) { 
        echo "<div style='font-family: \"Lucida Console\", Monaco, monospace'>";
        $padSize = ini_get('output_buffering');
        $dahdi = "";
        $cmd   = "/usr/bin/issabel-helper migration $dahdi $filename";
        $cmd .= " 2>&1 || echo \"err_flag\"";

        $file = popen($cmd,"r");
        while(!feof($file)) {
            $line = fgets($file);
            if($line == "err_flag\n") {
                echo "Error!\n";
                $error = true;
                break;
        }
```
The filename which is a userinput is being concatenated in a cmd variable to be latter used in popen function , some security controls are in place like adding directroy prefix , using substr , escapeshellarg however that wasn't enough

if we are able to write a filename called : `test|id` , the command will be executed anyway but we also need to place it in the same directory called "backup_dir" cause directory traversal will not work as the `escapeshellarg` is in place 

after searching here and there found a component (asterisk) in the dashboard allowing dumping xml documents into arbitary location in file system meaning we can dump it to `$backup_dir` which is `/var/www/backup/` **Default value** 

so eventually we will dump it to `/var/www/backup/test|id` then call the endpoint hosting the mentioned code snippet to have the command executed !

## Credits

- https://www.cve.org/CVERecord?id=CVE-2024-0986
- https://github.com/advisories/GHSA-v9pc-9fc9-4ff8
